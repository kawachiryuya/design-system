# インラインバリデーション

## メタ情報
- カテゴリ: インタラクション原則 > Feedback
- 適用範囲: Atom〜Molecule
- ステータス: Approved
- 最終更新: 2024-02-17

## 原則の定義

**フォーム入力の問題を、送信前にその場で伝えて修正を促す**

インラインバリデーションは、フィールドの直下にエラーや成功のメッセージを表示します。ユーザーが送信ボタンを押すまで待たずに問題を伝えることで、フォームの完了率を上げ、フラストレーションを減らします。

## バリデーションのタイミング

### 3つのタイミング

| タイミング | トリガー | 用途 |
|-----------|---------|------|
| **onBlur（推奨）** | フィールドからフォーカスが外れた時 | ほとんどのケース |
| **onChange** | 入力中リアルタイム | 文字数制限・パスワード強度 |
| **onSubmit** | 送信ボタン押下時 | 必須項目・依存関係のある項目 |

### onBlurを基本とする理由

```
❌ onChange（入力中にエラー）の問題:
「メールを入力してください」
→ 「m」を打った瞬間にエラーが出る
→ ユーザーの邪魔をする

✅ onBlur（離れた後にエラー）:
入力し終えてから「形式が正しくありません」
→ 完成した入力を評価するので自然
```

### パスワード強度はonChangeが適切

```
入力中にリアルタイムで強度を表示:
[●●●●○○○] 中程度
→ 目標に向かって入力できるのでUXが向上
```

## 表示の仕様

### 配置

```
┌─────────────────────────────┐
│ メールアドレス               │  ← ラベル
├─────────────────────────────┤
│ user@                       │  ← 入力フィールド（エラー時: 赤ボーダー）
└─────────────────────────────┘
⚠ メールアドレスの形式が正しくありません  ← エラーメッセージ（フィールド直下）
```

エラーメッセージは**常にフィールドの直下**。ページ上部にまとめて表示しない。

### 3つの状態

**デフォルト（未入力）**
```
border: neutral-300
ラベル: neutral-700
ヘルプテキスト: neutral-500（任意）
```

**エラー**
```
border: error-600
ラベル: neutral-700（変えない）
エラーテキスト: error-600 + エラーアイコン
```

**成功（確認が必要な場合のみ）**
```
border: success-600
成功テキスト: success-600 + チェックアイコン
```
※ 成功状態は必ずしも表示しなくてよい。確認が重要な場合（メールアドレス・パスワード等）のみ。

## エラーメッセージの書き方

### 原則: 「何が問題か」「どうすれば直るか」を伝える

```
❌ 悪い例:
「無効な入力です」     → 何が無効か分からない
「エラーがあります」   → 何のエラーか分からない
「必須項目です」だけ   → 何を入力すればいいか分からない

✅ 良い例:
「メールアドレスを入力してください」
「メールアドレスの形式が正しくありません（例: user@example.com）」
「パスワードは8文字以上で入力してください（現在: 5文字）」
```

### 長さ

- 1〜2文。簡潔に。
- 専門用語を避ける（「invalid format」ではなく「形式が正しくありません」）

## 複数エラーの扱い

### フォーム送信時

送信ボタン押下時に複数のエラーがある場合:

```
1. すべてのエラーをその場で表示（まとめない）
2. 最初のエラーフィールドにフォーカスを移動
3. スクリーンリーダー向けにエラー件数を通知

例: "3件の入力エラーがあります。最初のエラーに移動しました。"
```

## アクセシビリティ

```html
<div>
  <label for="email">メールアドレス</label>
  <input
    id="email"
    type="email"
    aria-invalid="true"
    aria-describedby="email-error"
  />
  <span id="email-error" role="alert">
    メールアドレスの形式が正しくありません
  </span>
</div>
```

- `aria-invalid="true"`: フィールドが無効であることを通知
- `aria-describedby`: エラーメッセージとフィールドを関連付け
- `role="alert"`: エラー表示時に自動で読み上げ

→ 詳細は [Screen Readers](../../foundation/accessibility/screen-readers.md) 参照

## チェックリスト

- [ ] エラーはフィールド直下に表示
- [ ] エラーメッセージが「何が問題か」「どうすれば直るか」を伝えている
- [ ] onBlurをメインのタイミングとして使用
- [ ] aria-invalid・aria-describedbyが設定されている
- [ ] 送信時にすべてのエラーを表示し、最初にフォーカスが移動
- [ ] 色だけでなくアイコン + テキストでエラーを表現

## 関連ドキュメント

- [Overview](./overview.md)
- [Toast Notifications](./toast-notifications.md): フォーム外の通知はこちら
- [Status States](../states/status-states.md): エラー状態の定義
- [Screen Readers](../../foundation/accessibility/screen-readers.md): ARIA属性

## バージョン履歴

| 日付 | バージョン | 変更内容 | 変更理由 |
|------|-----------|----------|----------|
| 2024-02-17 | 1.0.0 | 初版作成 | Phase 2 |
