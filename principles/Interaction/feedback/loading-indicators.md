# ローディングインジケーター

## メタ情報
- カテゴリ: インタラクション原則 > Feedback
- 適用範囲: Atom〜Page
- ステータス: Approved
- 最終更新: 2024-02-17

## 原則の定義

**処理中であることを伝え、ユーザーの「フリーズしたか？」という不安を取り除く**

ローディング表示がないと、ユーザーは「何も起きていないのか、処理中なのか」を判断できず、同じ操作を繰り返したり、離脱したりします。

## 表示の判断基準

### 待機時間と表示の関係

| 待機時間 | ユーザーの体感 | 対応 |
|---------|-------------|------|
| 〜100ms | 即時 | 表示不要 |
| 100ms〜1秒 | わずかな遅延 | 任意（短時間のスピナー） |
| 1〜10秒 | 待っていると感じる | **必須**（スピナー or スケルトン） |
| 10秒以上 | 長い | **必須** + 進捗表示（可能なら） |

### 0.1秒以下は表示しない

短い処理でローディングを表示すると、ちらつきが発生して逆効果。

```typescript
// 最低表示時間を設ける
const MIN_LOADING_DURATION = 300; // ms

const startTime = Date.now();
await fetchData();
const elapsed = Date.now() - startTime;

if (elapsed < MIN_LOADING_DURATION) {
  await delay(MIN_LOADING_DURATION - elapsed);
}
```

## 3つのパターン

### 1. スピナー（Spinner）

**用途**: 処理時間が不明、コンパクトなスペース

```
インライン（ボタン内）:
[  ⟳ 送信中...  ]

コンポーネント中央:
┌─────────────────┐
│                 │
│       ⟳        │
│                 │
└─────────────────┘

全画面オーバーレイ（大きな処理）:
┌─────────────────┐
│                 │
│    ⟳ 処理中    │
│                 │
└─────────────────┘
```

**サイズ**:
- インライン: 16px（テキストと同じ高さ）
- コンポーネント: 24〜32px
- 全画面: 48px

### 2. スケルトンスクリーン（Skeleton）

**用途**: コンテンツの形が予測できる場合（カード・リスト等）

```
読み込み中:                    読み込み後:
┌─────────────────────┐       ┌─────────────────────┐
│ ████████████        │       │ 山田 太郎            │
│ ██████              │       │ デザインエンジニア    │
│                     │       │                     │
│ ████████████████    │       │ 最新の投稿を確認...   │
└─────────────────────┘       └─────────────────────┘
```

**スケルトンの利点**: コンテンツの形を事前に見せることで、ユーザーが読み込み後をイメージしやすい。主観的な待機時間が短く感じられる。

**アニメーション**: 左から右へのシマーアニメーション（グラデーションが流れる）

```css
.skeleton {
  background: linear-gradient(
    90deg,
    neutral-100 25%,
    neutral-50 50%,
    neutral-100 75%
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}
```

### 3. ブラー/フェード（Blur / Fade）

**用途**: 既存コンテンツを更新する場合（ページネーション等）

```
更新前:        更新中:          更新後:
┌──────┐      ┌──────┐         ┌──────┐
│コンテ │  →   │コ▓▓▓ │  →      │新しい │
│ンツA  │      │ン▓▓▓ │         │コンテ │
└──────┘      └──────┘         └──────┘
```

既存コンテンツをフェードアウトしながら新しいコンテンツをフェードイン。完全な空白にしない。

## ローディング中の操作制御

### ボタンを無効化する

ローディング中は、同じアクションを再度実行できないようにする。

```html
<button disabled aria-busy="true">
  <Spinner size="sm" />
  送信中...
</button>
```

- `disabled`: クリック不可
- `aria-busy="true"`: スクリーンリーダーへの通知

### 何を無効化するか

```
✅ 無効化すべき: 同じアクションを起こすボタン
✅ 無効化すべき: データを変更する操作

❌ 無効化しない: キャンセルボタン
❌ 無効化しない: ページ移動・閉じるボタン
```

## アクセシビリティ

```html
<!-- スピナー -->
<div role="status" aria-label="読み込み中">
  <Spinner aria-hidden="true" />
</div>

<!-- スケルトン -->
<div aria-busy="true" aria-label="コンテンツを読み込み中">
  <SkeletonCard />
</div>
```

- `role="status"` + `aria-label`: スクリーンリーダーへの通知
- スピナーのSVGには `aria-hidden="true"`（読み上げ対象外）

→ 詳細は [Screen Readers](../../foundation/accessibility/screen-readers.md) 参照

## 使い分けのまとめ

| 状況 | 推奨パターン |
|------|------------|
| ボタン押下後の処理 | インラインスピナー（ボタン内） |
| カード・リストの初期読み込み | スケルトンスクリーン |
| ページ全体の処理（例: ファイル処理） | 全画面オーバーレイ + スピナー |
| ページネーション・フィルタ更新 | ブラー + スピナー |
| 長時間処理 | スピナー + プログレスバー |

## チェックリスト

- [ ] 1秒以上の処理にはローディング表示
- [ ] ローディング中はアクションボタンをdisabled
- [ ] aria-busy / role="status" を設定
- [ ] キャンセルボタンはdisabledにしない
- [ ] スケルトンのアニメーションが prefers-reduced-motion に対応

## 関連ドキュメント

- [Overview](./overview.md)
- [Progress Indicators](./progress-indicators.md): 進捗の可視化
- [Status States](../states/status-states.md): Loading状態の定義
- [State Transitions](../states/state-transitions.md): アニメーション時間

## バージョン履歴

| 日付 | バージョン | 変更内容 | 変更理由 |
|------|-----------|----------|----------|
| 2024-02-17 | 1.0.0 | 初版作成 | Phase 2 |
