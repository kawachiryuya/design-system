# フォームパターン

## メタ情報
- カテゴリ: パターン原則
- 適用範囲: Molecule〜Organism
- ステータス: Approved
- 最終更新: 2024-02-17

## 原則の定義

**フォームは、ユーザーとシステムの対話の中で最も摩擦が生じやすい箇所であり、入力の負担を最小化し、エラーを起こしにくい設計にする**

## なぜフォーム設計が重要か

フォームの離脱率は高い。主な原因:

- **長すぎる**: 入力項目が多くて面倒に感じる
- **分かりにくいラベル**: 何を入力すればいいか分からない
- **エラーが不親切**: どう直せばいいか分からない
- **送信したら消えた**: 入力内容が保持されない

適切なフォーム設計はコンバージョン率を直接改善します。

## フォームの基本原則

### 1. 必要な項目だけ聞く

```
Before:
[氏名] [ふりがな] [生年月日] [性別] [電話番号]
[メール] [郵便番号] [住所] [建物名] [備考]

After:
[メール] [パスワード]
（あとで必要になったら追加で聞く）
```

**判断基準**: 「この情報が本当に今必要か？」を問い直す。後で聞けるものは後で聞く。

### 2. 1カラムレイアウト

```
✅ 推奨: 1カラム（縦に積み上げ）

[氏名          ]
[メール        ]
[パスワード    ]

❌ 非推奨: 2カラム横並び（関連する短い項目以外）

[姓    ] [名    ]  ← 姓名は例外（関連する）
[電話  ] [郵便番号]  ← これは非推奨
```

**理由**: 2カラムはスキャン順序が曖昧になり、モバイルでも崩れやすい。

**例外**: 姓・名、都道府県・市区町村など、明確に関連する短い項目は横並びにしてよい。

### 3. ラベルはフィールドの上

```
✅ 推奨: 上ラベル
メールアドレス
[                    ]

❌ 非推奨: プレースホルダーのみ
[メールアドレスを入力]  ← 入力後にラベルが消える
```

**理由**: プレースホルダーは入力後に消えるため、何を入力したか確認できない。入力中のラベルがあることで認知負荷が下がる。

## フォームの構成要素

### ラベル（Label）

```
必須項目: ラベルの末尾に「*」または「必須」
任意項目: 「任意」と明示（または何も付けない）

メールアドレス *
[                    ]

電話番号（任意）
[                    ]
```

**原則**: 必須と任意のどちらかをマークする。両方マークするのは冗長。項目の大半が必須なら「*」で必須のみマーク。任意が多いなら「任意」で任意のみマーク。

### ヘルプテキスト

```
パスワード
[                    ]
8文字以上、英数字を組み合わせてください  ← ヘルプテキスト（フィールド直下）
```

- 入力例、形式の説明、制約を記載
- 簡潔に（1〜2文）
- エラーメッセージと混在しないよう、エラー時はエラーメッセージに置き換える

### フィールドの幅

```
フィールドの幅 = 入力内容の長さの目安

[郵便番号   ]  ← 短い（7文字）
[電話番号       ]  ← 中程度（11文字）
[メールアドレス              ]  ← 長い
[本文                                        ]  ← 最大幅
```

幅がヒントになる。郵便番号フィールドが画面幅いっぱいだと「何桁入れるの？」と戸惑う。

## フォームのレイアウトパターン

### シンプルフォーム

```
用途: ログイン・登録・問い合わせ等
特徴: 1画面で完結、5項目以内

┌────────────────────┐
│  ログイン           │
│                    │
│  メール            │
│  [              ]  │
│                    │
│  パスワード        │
│  [              ]  │
│                    │
│  [  ログイン  ]    │  ← Primary（右または全幅）
│  パスワードを忘れた │  ← Tertiary
└────────────────────┘
```

### セクション分割フォーム

```
用途: 入力項目が多い（10項目以上）
特徴: 関連する項目をグループ化

── 基本情報 ─────────────────
[氏名] [ふりがな]
[生年月日]

── 連絡先 ───────────────────
[メールアドレス]
[電話番号]

── 住所 ─────────────────────
[郵便番号] → [住所自動入力]
[都道府県] [市区町村]
[建物名・部屋番号]
```

セクションヘッダーで視覚的に区切り、関連項目をまとめる。

### マルチステップフォーム（ウィザード）

```
用途: 複雑な申込・設定・オンボーディング
特徴: 複数の画面に分割、進捗を表示

① 基本情報 → ② プラン選択 → ③ 支払い → ④ 確認
   [現在]

[氏名]
[メール]

[  戻る  ]  [  次へ  ]  ← ボタン配置
```

**いつ分割するか**:
- 15項目以上
- 入力カテゴリが明確に分かれている
- 前のステップの情報が次のステップに影響する

→ 進捗表示は [Progress Indicators](../interaction/feedback/progress-indicators.md) 参照  
→ ボタン配置は [Action Placement](../interaction/button/placement.md) 参照

## 入力の補助

### 自動補完・自動入力

```html
<!-- ブラウザの自動補完を有効にする -->
<input type="email" autocomplete="email" />
<input type="tel" autocomplete="tel" />
<input name="zip" autocomplete="postal-code" />
```

`autocomplete` 属性を適切に設定することで、ブラウザやパスワードマネージャーの補完が機能し、入力の手間が大幅に減る。

### 適切なinput type

```html
<!-- デバイスに応じたキーボードが表示される -->
<input type="email" />   ← @キーが出やすいキーボード
<input type="tel" />     ← 数字キーボード
<input type="number" />  ← 数字キーボード
<input type="url" />     ← /.comが出やすいキーボード
<input type="date" />    ← ネイティブのDate Picker
```

### 郵便番号から住所自動入力

```
[郵便番号 ] [検索]
          ↓ 自動入力
[都道府県: 東京都          ]
[市区町村: 渋谷区渋谷      ]
```

ユーザーの入力量を減らす最も効果的な手段の一つ。

## 送信前の確認

### いつ確認画面を設けるか

```
確認画面が必要:
- 取り消しできない操作（決済・申込・退会）
- 大量のデータ送信

確認画面が不要:
- 後から編集できる設定
- ログイン・登録（即座のフィードバックで十分）
```

### 確認画面のパターン

```
入力内容の確認

── 基本情報 ─────────────────
氏名: 山田 太郎
メール: yamada@example.com

── 支払い ───────────────────
プラン: スタンダード ¥1,980/月
カード: **** **** **** 1234

[  修正する  ]  [  送信する  ]
```

- すべての入力値を表示する
- 「修正する」は各セクションまたは全体に戻れる
- 「送信する」はPrimaryボタン

## アクセシビリティ

### フォームの基本設定

```html
<form novalidate>  <!-- ブラウザのデフォルトバリデーションを無効化 -->
  <div>
    <label for="email">メールアドレス <span aria-label="必須">*</span></label>
    <input
      id="email"
      type="email"
      autocomplete="email"
      aria-required="true"
      aria-invalid="false"
    />
  </div>
</form>
```

- `<label for="...">`: 必ずinputと関連付ける
- `aria-required="true"`: スクリーンリーダーへの必須通知
- `novalidate`: ブラウザのデフォルトUIではなく、カスタムバリデーションを使う

→ バリデーションのARIAは [Inline Validation](../interaction/feedback/inline-validation.md) 参照  
→ キーボード操作は [Keyboard Navigation](../foundation/accessibility/keyboard-navigation.md) 参照

## チェックリスト

### 設計
- [ ] 本当に必要な項目だけに絞った
- [ ] 1カラムレイアウト（横並びは関連項目のみ）
- [ ] ラベルはフィールドの上
- [ ] 必須・任意が明示されている
- [ ] フィールド幅が入力内容の長さの目安になっている

### 実装
- [ ] `<label for>` が正しく設定されている
- [ ] `autocomplete` 属性が適切
- [ ] 適切な `input type` を使用
- [ ] `aria-required` が設定されている
- [ ] バリデーションがonBlurで動作（送信時も全チェック）

### 送信
- [ ] ローディング中はボタンをdisabled
- [ ] エラー時は最初のエラーフィールドにフォーカス
- [ ] 取り消せない操作には確認画面

## 関連ドキュメント

- **[Inline Validation](../interaction/feedback/inline-validation.md)**: バリデーションの表示
- **[Action Placement](../interaction/button/placement.md)**: 送信ボタンの配置
- **[Loading Indicators](../interaction/feedback/loading-indicators.md)**: 送信中の表示
- **[Progress Indicators](../interaction/feedback/progress-indicators.md)**: ウィザードの進捗
- **[Keyboard Navigation](../foundation/accessibility/keyboard-navigation.md)**: Tab順序
- **[Spacing](../layout/spacing.md)**: フォーム内の余白

## バージョン履歴

| 日付 | バージョン | 変更内容 | 変更理由 |
|------|-----------|----------|----------|
| 2024-02-17 | 1.0.0 | 初版作成 | Phase 2 |
